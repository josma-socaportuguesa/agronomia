<!DOCTYPE html>
<html>
<head>
	<title></title>
	<link href='https://fonts.googleapis.com/css?family=Open+Sans|Oswald' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" type="text/css" href="css/cuerpo.css">
	<link rel="stylesheet" type="text/css" href="css/menu.css">
	<link rel="stylesheet" type="text/css" href="css/formulario.css">
</head>
<body>
	<div contenedor>
		
	</div>
</body>
<script type="text/javascript" src='js/constructor.js'></script>
<script type="text/javascript">
	//borrar
	var contId=4;
	var registros = [
						{
							nombre:'cuentasxpagar',
							id:1,
							descripcion:'cuentasxpagar',
							empresas:[
									{id:'3',nombre:'ProbioAgro'},{id:'2',nombre:'SocaPortuguesa'}
								]
						},
						{
							nombre:'administrador',
							id:2,
							descripcion:'este rol esta encargado de supervisar lo que ocurre dentro del sistema con opcion a ver la mayoria de los modulos ademas de asegurar el correcto funcionamiento del mismo',
							empresas:[
									{id:'3',nombre:'ProbioAgro'},{id:'2',nombre:'SocaPortuguesa'},{id:'1',nombre:'SocaServicios'}
								]
						},
						{
							nombre:'almacen-facturacion',
							id:3,
							descripcion:'factura en almacen',
							empresas:[
									{id:'2',nombre:'SocaPortuguesa'}
								]
						}
					];
	var empresas = [
		{	
			id:'1',
			nombre:'SocaServicios'
		},{
			id:'2',
			nombre:'ProbioAgro'
		},{
			id:'3',
			nombre:'SocaPortuguesa'
		},{
			id:'4',
			nombre:'E/S Piedritas Blancas'
		}
	]
	
	//Inicialiazion de formulario
	var interfaz = new Arquitecto();
	var botones = ['buscar','nuevo','abrir'];
	
	interfaz.configure();
	interfaz.elementos.botonera = new Botonera(botones);
	interfaz.elementos.formulario = new Formulario();
	interfaz.elementos.formulario.cargarRegistros(registros);
	//boton buscar
	interfaz.elementos.botonera.buscarBoton('nuevo').nodo.onclick=function(){
		console.log('presiono Nuevo');
		var data = {
			tipo:'nuevo'
		}
		var formulario = interfaz.elementos.formulario;
		formulario.construirInterfaz(data);
	}
	//boton nuevo
	interfaz.elementos.botonera.buscarBoton('buscar').nodo.onclick=function(){
		console.log('presiono Buscar');
		interfaz.elementos.formulario.nodo.firstChild.getElementsByTagName('input')[0].focus();
	}
	//funcionamiento exclusivo del formulario
	function guardar(){
		var formulario = document.formNuevo;
		var data = new Array();
		var elemento;
		var validacion=false;
		for(var x=0;x<formulario.elements.length;x++){
			if(formulario.elements[x].type='text'){
				if(formulario.elements[x].value==''){
					validacion=true;
				}
				elemento = {nombre:formulario.elements[x].name,valor:formulario.elements[x].value};
				data.push(elemento);
			}
		}
		if(!validacion){
			var nuevoRegistro = {
				nombre : data[0].valor,
				id : contId++,
				descripcion : data[1].valor,
				empresas : []
			}
			registros.push(nuevoRegistro);
			var nuevoSlot=interfaz.elementos.formulario.agregarSlot(nuevoRegistro);
			nuevoSlot.firstChild.click();
		}else{
			console.log('formulario no paso la validacion');
		}
	}
	function buscarEmpresas(id){
		console.log('se disparo una busueda de empresas con id:'+id);
		var data = new Array();
		for(var x=0;x<registros.length;x++){
			if(registros[x].id==id){
				for(var y=0;y<registros[x].empresas.length;y++){
					data.push(registros[x].empresas[y]);
				}
			}
		}
		return data;
	}
	function buscarRegistro(id){
		var registro=false;
		for(var x=0;x<registros.length;x++){
			if(registros[x].id==id){
				registro=registros[x];
			}
		}
		return registro;
	}
	function editarCampo(id,campo,valor){
		var registro=buscarRegistro(id);
		registro[campo]=valor;
		return registro;
	}
	function guardarEnDetalle(id,cambios){
		var registro=buscarRegistro(id)
		for(var x=0;x<cambios.length;x++){
			registro.empresas.push(cambios[x]);
		}
		return registro;
	}
</script>
</html>